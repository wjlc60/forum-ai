{"version":3,"sources":["../src/filters.js"],"names":["init","root","jqRoot","document","ready","hide","removeClass","generateWithFilters","event","newLink","attr","preventDefault","filterParams","target","search","substr","submit","on","submitWithFilter","containerelement","addClass","CustomEvents","events","activate","Selectors","filters","group","selectall","deselected","querySelectorAll","checkbox","forEach","checked","clear","selected","trigger","referenceElement","querySelector","popperContent","popover","Popper","placement","classList","remove","add","setAttribute","save"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module responsible for handling forum summary report filters.\n *\n * @module     forumreport_summary/filters\n * @package    forumreport_summary\n * @copyright  2019 Michael Hawkins <michaelh@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Popper from 'core/popper';\nimport CustomEvents from 'core/custom_interaction_events';\nimport Selectors from 'forumreport_summary/selectors';\n\nexport const init = (root) => {\n    let jqRoot = $(root);\n\n    // Hide loading spinner and show report once page is ready.\n    // This ensures filters can be applied when sorting by columns.\n    $(document).ready(function() {\n        $('.loading-icon').hide();\n        $('#summaryreport').removeClass('hidden');\n    });\n\n    // Generic filter handlers.\n\n    // Called to override click event to trigger a proper generate request with filtering.\n    var generateWithFilters = (event) => {\n        var newLink = $('#filtersform').attr('action');\n\n        if (event) {\n            event.preventDefault();\n\n            let filterParams = event.target.search.substr(1);\n            newLink += '&' + filterParams;\n        }\n\n        $('#filtersform').attr('action', newLink);\n        $('#filtersform').submit();\n    };\n\n    // Override 'reset table preferences' so it generates with filters.\n    $('.resettable').on(\"click\", \"a\", function(event) {\n        generateWithFilters(event);\n    });\n\n    // Override table heading sort links so they generate with filters.\n    $('thead').on(\"click\", \"a\", function(event) {\n        generateWithFilters(event);\n    });\n\n    // Override pagination page links so they generate with filters.\n    $('.pagination').on(\"click\", \"a\", function(event) {\n        generateWithFilters(event);\n    });\n\n    // Submit report via filter\n    var submitWithFilter = (containerelement) => {\n        // Close the container (eg popover).\n        $(containerelement).addClass('hidden');\n\n        // Submit the filter values and re-generate report.\n        generateWithFilters(false);\n    };\n\n    // Groups filter specific handlers.\n\n    // Event handler for clicking select all groups.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.selectall, function() {\n        let deselected = root.querySelectorAll(Selectors.filters.group.checkbox + ':not(:checked)');\n        deselected.forEach(function(checkbox) {\n            checkbox.checked = true;\n        });\n    });\n\n    // Event handler for clearing filter by clicking option.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.clear, function() {\n        // Clear checkboxes.\n        let selected = root.querySelectorAll(Selectors.filters.group.checkbox + ':checked');\n        selected.forEach(function(checkbox) {\n            checkbox.checked = false;\n        });\n    });\n\n    // Event handler for showing groups filter popover.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.trigger, function() {\n        // Create popover.\n        var referenceElement = root.querySelector(Selectors.filters.group.trigger),\n            popperContent = root.querySelector(Selectors.filters.group.popover);\n\n        new Popper(referenceElement, popperContent, {placement: 'bottom'});\n\n        // Show popover.\n        popperContent.classList.remove('hidden');\n\n        // Change to outlined button.\n        referenceElement.classList.add('btn-outline-primary');\n        referenceElement.classList.remove('btn-primary');\n\n        // Let screen readers know that it's now expanded.\n        referenceElement.setAttribute('aria-expanded', true);\n    });\n\n    // Event handler to click save groups filter.\n    jqRoot.on(CustomEvents.events.activate, Selectors.filters.group.save, function() {\n        submitWithFilter('#filter-groups-popover');\n    });\n};\n"],"file":"filters.min.js"}
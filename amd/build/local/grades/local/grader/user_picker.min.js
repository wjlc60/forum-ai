define ("mod_forum/local/grades/local/grader/user_picker",["exports","core/templates","./user_picker/selectors","core/str"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;b=e(b);c=e(c);function e(a){return a&&a.__esModule?a:{default:a}}function f(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function g(a){for(var b=1,c;b<arguments.length;b++){c=null!=arguments[b]?arguments[b]:{};b%2?f(Object(c),!0).forEach(function(b){h(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):f(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}function h(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}function i(a,b){return n(a)||m(a,b)||k(a,b)||j()}function j(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function k(a,b){if(!a)return;if("string"==typeof a)return l(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(a);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return l(a,b)}function l(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function m(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null==c)return;var d=[],e=!0,f=!1,g,h;try{for(c=c.call(a);!(e=(g=c.next()).done);e=!0){d.push(g.value);if(b&&d.length===b)break}}catch(a){f=!0;h=a}finally{try{if(!e&&null!=c["return"])c["return"]()}finally{if(f)throw h}}return d}function n(a){if(Array.isArray(a))return a}function o(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function p(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var f=a.apply(b,c);function g(a){o(f,d,e,g,h,"next",a)}function h(a){o(f,d,e,g,h,"throw",a)}g(void 0)})}}function q(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function r(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function s(a,b,c){if(b)r(a.prototype,b);if(c)r(a,c);Object.defineProperty(a,"prototype",{writable:!1});return a}var t=function(){function a(b,c,d){q(this,a);this.userList=b;this.showUserCallback=c;this.preChangeUserCallback=d;this.currentUserIndex=0;this.render=this.render.bind(this);this.setUserId=this.setUserId.bind(this)}s(a,[{key:"setUserId",value:function setUserId(a){var b=this.userList.findIndex(function(b){return b.id===parseInt(a)});if(-1===b){throw Error("User with id ".concat(a," not found"))}this.currentUserIndex=b}},{key:"render",value:function(){var a=p(regeneratorRuntime.mark(function a(){var c,d,e;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:this.root=document.createElement("div");a.next=3;return this.renderNavigator();case 3:c=a.sent;d=c.html;e=c.js;b.default.replaceNodeContents(this.root,d,e);a.next=9;return this.showUser(this.currentUser);case 9:this.registerEventListeners();case 10:case"end":return a.stop();}}},a,this)}));return function render(){return a.apply(this,arguments)}}()},{key:"renderNavigator",value:function renderNavigator(){return b.default.renderForPromise("".concat("mod_forum/local/grades/local/grader","/user_picker"),{})}},{key:"renderUserChange",value:function renderUserChange(a){return b.default.renderForPromise("".concat("mod_forum/local/grades/local/grader","/user_picker/user"),a)}},{key:"showUser",value:function(){var a=p(regeneratorRuntime.mark(function e(a){var f,g,h,j,k,l,m;return regeneratorRuntime.wrap(function(e){while(1){switch(e.prev=e.next){case 0:e.next=2;return Promise.all([this.renderUserChange(a),this.showUserCallback(a)]);case 2:f=e.sent;g=i(f,1);h=g[0];j=h.html;k=h.js;l=this.root.querySelector(c.default.regions.userRegion);b.default.replaceNodeContents(l,j,k);m=this.root.querySelector(c.default.regions.currentUser);e.next=12;return(0,d.get_string)("nowgradinguser","mod_forum",a.fullname);case 12:m.textContent=e.sent;case 13:case"end":return e.stop();}}},e,this)}));return function showUser(){return a.apply(this,arguments)}}()},{key:"registerEventListeners",value:function registerEventListeners(){var a=this;this.root.addEventListener("click",function(){var b=p(regeneratorRuntime.mark(function d(b){var e,f;return regeneratorRuntime.wrap(function(d){while(1){switch(d.prev=d.next){case 0:e=b.target.closest(c.default.actions.changeUser);if(!e){d.next=9;break}d.next=4;return a.preChangeUserCallback(a.currentUser);case 4:f=d.sent;if(f.failed){d.next=9;break}a.updateIndex(parseInt(e.dataset.direction));d.next=9;return a.showUser(a.currentUser);case 9:case"end":return d.stop();}}},d)}));return function(){return b.apply(this,arguments)}}())}},{key:"updateIndex",value:function updateIndex(a){this.currentUserIndex+=a;if(0>this.currentUserIndex){this.currentUserIndex=this.userList.length-1}else if(this.currentUserIndex>this.userList.length-1){this.currentUserIndex=0}return this.currentUserIndex}},{key:"currentUser",get:function get(){return g(g({},this.userList[this.currentUserIndex]),{},{total:this.userList.length,displayIndex:this.currentUserIndex+1})}},{key:"rootNode",get:function get(){return this.root}}]);return a}(),u=function(){var a=p(regeneratorRuntime.mark(function d(a,b,c){var e,f,g,h,i=arguments;return regeneratorRuntime.wrap(function(d){while(1){switch(d.prev=d.next){case 0:e=3<i.length&&i[3]!==void 0?i[3]:{},f=e.initialUserId,g=void 0===f?null:f;h=new t(a,b,c);if(g){h.setUserId(g)}d.next=5;return h.render();case 5:return d.abrupt("return",h);case 6:case"end":return d.stop();}}},d)}));return function(){return a.apply(this,arguments)}}();a.default=u;return a.default});
//# sourceMappingURL=user_picker.min.js.map

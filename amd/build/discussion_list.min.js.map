{"version":3,"sources":["../src/discussion_list.js"],"names":["define","$","Templates","String","Notification","SubscriptionToggle","Selectors","Repository","registerEventListeners","root","on","favourite","toggle","toggleElement","forumId","data","discussionId","subscriptionState","setFavouriteDiscussionState","then","location","reload","catch","exception","pin","e","preventDefault","state","setPinDiscussionState","lock","setDiscussionLockState","context","icon","parents","summary","actions","find","locked","removeClass","addClass","forumid","render","html","js","replaceNode","get_string","done","s","addNotification","message","type","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module for the list of discussions on when viewing a forum.\n *\n * @module     mod_forum/discussion_list\n * @package    mod_forum\n * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/templates',\n    'core/str',\n    'core/notification',\n    'mod_forum/subscription_toggle',\n    'mod_forum/selectors',\n    'mod_forum/repository',\n], function(\n    $,\n    Templates,\n    String,\n    Notification,\n    SubscriptionToggle,\n    Selectors,\n    Repository\n) {\n    var registerEventListeners = function(root) {\n        root.on('click', Selectors.favourite.toggle, function() {\n            var toggleElement = $(this);\n            var forumId = toggleElement.data('forumid');\n            var discussionId = toggleElement.data('discussionid');\n            var subscriptionState = toggleElement.data('targetstate');\n            Repository.setFavouriteDiscussionState(forumId, discussionId, subscriptionState)\n                .then(function() {\n                    return location.reload();\n                })\n                .catch(Notification.exception);\n        });\n\n        root.on('click', Selectors.pin.toggle, function(e) {\n            e.preventDefault();\n            var toggleElement = $(this);\n            var forumId = toggleElement.data('forumid');\n            var discussionId = toggleElement.data('discussionid');\n            var state = toggleElement.data('targetstate');\n            Repository.setPinDiscussionState(forumId, discussionId, state)\n                .then(function() {\n                    return location.reload();\n                })\n                .catch(Notification.exception);\n        });\n\n        root.on('click', Selectors.lock.toggle, function(e) {\n            var toggleElement = $(this);\n            var forumId = toggleElement.data('forumid');\n            var discussionId = toggleElement.data('discussionid');\n            var state = toggleElement.data('state');\n\n            Repository.setDiscussionLockState(forumId, discussionId, state)\n                .then(function(context) {\n                    var icon = toggleElement.parents(Selectors.summary.actions).find(Selectors.lock.icon);\n                    if (context.locked) {\n                        icon.removeClass('hidden');\n                    } else {\n                        icon.addClass('hidden');\n                    }\n                    return context;\n                })\n                .then(function(context) {\n                    context.forumid = forumId;\n                    return Templates.render('mod_forum/discussion_lock_toggle', context);\n                })\n                .then(function(html, js) {\n                    return Templates.replaceNode(toggleElement, html, js);\n                })\n                .then(function() {\n                    return String.get_string('lockupdated', 'forum')\n                        .done(function(s) {\n                            return Notification.addNotification({\n                                message: s,\n                                type: \"info\"\n                            });\n                        });\n                })\n                .catch(Notification.exception);\n\n            e.preventDefault();\n        });\n    };\n\n    return {\n        init: function(root) {\n            SubscriptionToggle.init(root);\n            registerEventListeners(root);\n        }\n    };\n});\n"],"file":"discussion_list.min.js"}